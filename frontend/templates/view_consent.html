{% extends "base.html" %}

{% block extra_css %}
<style>
    .pdf-container {
        border: 2px solid var(--mes-border);
        border-radius: 8px;
        margin: 1.5rem 0;
        height: 70vh;
        overflow: hidden;
        background: white;
    }
    
    .pdf-iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
    
    .patient-info-card {
        background: linear-gradient(135deg, var(--mes-light-gray) 0%, #e9ecef 100%);
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        border-left: 4px solid var(--mes-red);
    }
    
    .instruction-card {
        background: #e7f3ff;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        border-left: 4px solid #007bff;
    }
    
    .button-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
        margin: 2rem 0;
    }
    
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }
    
    @media (max-width: 768px) {
        .pdf-container {
            height: 60vh;
        }
        
        .button-group {
            flex-direction: column;
        }
        
        .button-group button {
            width: 100%;
        }
        
        .info-grid {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 480px) {
        .pdf-container {
            height: 50vh;
        }
        
        .patient-info-card,
        .instruction-card {
            padding: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <h2 style="color: var(--mes-red); margin-bottom: 1.5rem;">Review Consent Form</h2>
    
    <div class="patient-info-card">
        <h3 style="color: var(--mes-dark-red); margin-bottom: 1rem;">Patient Details</h3>
        <div class="info-grid">
            <div><strong>Name:</strong> {{ consent_data.patient_name }}</div>
            <div><strong>MRN:</strong> {{ consent_data.patient_mrn }}</div>
            <div><strong>Age:</strong> {{ consent_data.patient_age }}</div>
            <div><strong>Consent For:</strong> {{ consent_data.consent_required_for }}</div>
            <div><strong>Procedure Details:</strong> {{ consent_data.procedure_details }}</div>
            <div><strong>Doctor:</strong> {{ consent_data.doctor }}</div>
            <div><strong>Signatory:</strong> {{ consent_data.signatory_name }}</div>
            <div><strong>Relationship:</strong> {{ consent_data.signatory_relation }}</div>
            <div><strong>Mobile:</strong> {{ consent_data.signatory_mobile }}</div>
        </div>
        
        <!-- Malayalam Translations -->
        {% if consent_data.consent_required_for_ml or consent_data.procedure_details_ml %}
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--mes-border);">
            <h4 style="color: var(--mes-red); margin-bottom: 0.5rem;">Malayalam Translations</h4>
            {% if consent_data.consent_required_for_ml %}
            <div><strong>Consent For (‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç):</strong> {{ consent_data.consent_required_for_ml }}</div>
            {% endif %}
            {% if consent_data.procedure_details_ml %}
            <div style="margin-top: 0.5rem;"><strong>Procedure Details (‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç):</strong> {{ consent_data.procedure_details_ml }}</div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <div class="instruction-card">
        <h4 style="color: #007bff; margin-bottom: 0.5rem;">üìã Important Instructions</h4>
        <p style="margin: 0; font-weight: 500;">Please read the entire consent form carefully. Scroll through all pages and ensure the patient understands all terms before proceeding to sign.</p>
    </div>
    
    <div class="pdf-container">
        <iframe 
            class="pdf-iframe"
            src="{{ pdf_url }}#toolbar=0&navpanes=0">
        </iframe>
    </div>
    
    <div class="button-group">
        <button class="btn-secondary" onclick="goBack()">‚Üê Back to Dashboard</button>
        <button class="btn-success" onclick="proceedToSignature()">‚úì I Have Read & Understand ‚Üí Proceed to Sign</button>
    </div>
</div>

<script>
    function proceedToSignature() {
        window.location.href = "{{ url_for('signature_page', filename=filename) }}";
    }
    
    function goBack() {
        window.location.href = "{{ url_for('dashboard') }}";
    }
    
    // Add some interactivity
    document.addEventListener('DOMContentLoaded', function() {
        const iframe = document.querySelector('.pdf-iframe');
        iframe.onload = function() {
            console.log('PDF loaded successfully');
        };
    });
</script>
{% endblock %}